<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dias de descanso</title>

    <style>
        body {
            font-family: Arial, sans-serif;
        }

        #calendar {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        #calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background-color: #333;
            color: #fff;
        }

        #days {
            display: flex;
            /* justify-content: space-between; */
            justify-content: space-around;
            padding: 10px;
            background: #333;
            color: #fff;

            div {
                text-align: center;
            }
        }

        #calendar-body {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #333;
            transition: opacity .5s ease;
            opacity: 1;

            .fade-out {
                opacity: 0;
            }

            div {
                padding: 20px;
                background: #fff;
                text-align: center;
            }

            div.today {
                background: rgb(255, 0, 0);
                color: #fff;
                /* opacity: .5; */
            }

            .descanso {
                color: #fff;
                background: blue;
            }

            .next-date {
                opacity: 0.6;
            }

            .prev-date {
                opacity: 0.6;
            }
        }

        .change-month {
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Dias de descanso</h1>
    <div id="calendar">
        <div id="calendar-header">
            <span id="month-prev" class="change-month">&lt;</span>
            <h2 id="month"></h2>
            <span id="month-next" class="change-month">&gt;</span>
        </div>
        <div id="days"></div>
        <div id="calendar-body">

        </div>
    </div>

    <script>

        // // Crear una fecha
        // const fecha2 = new Date(2024, 8, 15); // 15 de septiembre de 2024

        // // Formatear la fecha
        // const fechaFormateada = format(fecha, 'dd/MM/yyyy'); // Formato: día/mes/año
        // console.log(fechaFormateada); // Muestra: "15/09/2024"

        // Crear una fecha
        const fecha2 = new Date(2024, 8, 13); // 15 de septiembre de 2024

        // Dar formato a la fecha
        // const opciones = { year: 'numeric', month: '2-digit', day: '2-digit' };
        // const fechaFormateada = fecha2.toLocaleDateString('es-ES', opciones);
        // console.log(fechaFormateada); // Muestra: "15/09/2024"

        const diaDescanso = 13;
        // let sumaDias = 0;
        // let sumaProxMes = 0;
        // let restaDias = 0;
        // let diasFaltantesTerminarMes = 0;
        // let posicionArray = 0;
        // let diasSeleccionados = [];
        let ultimoDiaMes = 0;
        let operacionDiasFinal = 0;
        let diasExcedentes = 0;
        // let nuevoValorDiaDesc = 0;
        // let l = 0;
        // const fechaDeReferencia = 0;
        let fechaDeReferencia = new Date(0);

        let date = new Date();

        function renderCalendar() {
            sumaDias = diaDescanso;
            date.setDate(1);

            const monthDays = document.getElementById('calendar-body');
            const month = document.getElementById('month');
            const daysElement = document.getElementById('days');

            //ultimo dia del mes - cantidad de dias que tiene el mes
            const lastDay = new Date(
                date.getFullYear(),
                date.getMonth() + 1,
                0
            ).getDate();

            //imprime 31 
            const prevLastDay = new Date(
                date.getFullYear(),
                date.getMonth(),
                0
            ).getDate();

            const firstDayIndex = date.getDay(); //imprime 0

            //imprime 1
            const lastDayIndex = new Date(
                date.getFullYear(),
                date.getMonth() + 1,
                0
            ).getDay();

            const nextDays = 7 - lastDayIndex - 1; //imprime 5 dias faltantes para terminar la semana pte x verificar

            const months = [
                'Enero',
                'Febrero',
                'Marzo',
                'Abril',
                'Mayo',
                'Junio',
                'Julio',
                'Agosto',
                'Septiembre',
                'Octubre',
                'Noviembre',
                'Diciembre'
            ];

            const days = [
                'DOM',
                'LUN',
                'MAR',
                'MIE',
                'JUE',
                'VIE',
                'SAB'
            ];

            month.innerText = `${months[date.getMonth()]} ${date.getFullYear()}`; //imprime nombre del mes
            daysElement.innerHTML = days.map(day => `<div>${day}</div>`).join(''); //imprime los dias de Dom a Sab

            let dates = '';

            //completa los dias finales del mes anterior
            for (let x = firstDayIndex; x > 0; x--) {
                dates += `<div class='prev-date'>${prevLastDay - x + 1}</div>`;
            }

            //Impresion de los dias del mes que se ve
            // --------Fecha de referencia / dia / mes / año------------- //permite tener un punto de partida
            // console.log('fecha2: ' + new Date().getFullYear() ++ );
            if (fecha2.getFullYear() >= new Date().getFullYear()) {
                // console.log('fecha2+: ' + fecha2);
                fechaDeReferencia = fecha2.getDate();
                // console.log('fechaDeReferencia: ' + fechaDeReferencia);
                for (let i = 1; i <= lastDay; i++) {
                    
                    // --------DIAS DEL MES ACTUAL-------------
                    if (date.getMonth() === new Date().getMonth() &&
                    date.getFullYear() === new Date().getFullYear()) {
                        
                        if (i === new Date().getDate() && i != sumaDias) {
                            dates += `<div class="today">${i}</div>`; //dia actual (hoy)
                        }
                        else if (fechaDeReferencia === i) {
                            dates += `<div class="descanso">${i}</div>`;
                            fechaDeReferencia += 8;
                            
                            ultimoDiaMes = fechaDeReferencia;
                            
                            
                            if (ultimoDiaMes > lastDay) {
                                operacionDiasFinal = ultimoDiaMes - lastDay;
                            }
                        }
                        else {
                            dates += `<div>${i}</div>` //dias del mes actual
                        }
                    }
                    // --------DIAS DE LOS DEMAS MESES-------------
                    else {
                        
                        if (operacionDiasFinal > 0) {

                            if (operacionDiasFinal === i) {

                                dates += `<div class="descanso">${i}</div>`;
                                operacionDiasFinal += 8;

                                if (operacionDiasFinal > lastDay) {
                                operacionDiasFinal -= lastDay;
                                }
                            }else {

                                dates += `<div>${i}</div>` //DIAS DE LOS DEMAS MESES
                            }

                        } else {

                            dates += `<div>${i}</div>` //DIAS DE LOS DEMAS MESES
                        }


                    }
                }

                //completa los dias finales del mes siguiente
                for (let j = 1; j <= nextDays; j++) {
                    dates += `<div class="next-date">${j}</div>`; //dias del proximo mes en la misma pantalla
                }

                monthDays.innerHTML = dates; //imprime los dias en el html (inserta)
            }


            //     else {
            //         for (let i = 1; i <= lastDay; i++) { //sin Punto de partida

            //             // --------MES ACTUAL-------------
            //             if (date.getMonth() === new Date().getMonth() &&
            //                 date.getFullYear() === new Date().getFullYear()) {

            //                 if (i === new Date().getDate() && i != sumaDias) {
            //                     dates += `<div class="today">${i}</div>`; //dia actual (hoy)
            //                 }
            //                 else {
            //                     dates += `<div>${i}</div>` //dias del mes actual
            //                 }
            //             }
            //             else {
            //                 dates += `<div>${i}</div>` //dias del mes actual
            //             }
            //         }
            //         //completa los dias finales del mes siguiente
            //         for (let j = 1; j <= nextDays; j++) {
            //             dates += `<div class="next-date">${j}</div>`; //dias del proximo mes en la misma pantalla
            //         }

            //         monthDays.innerHTML = dates; //imprime los dias en el html (inserta)
            //     }

        }



        document.getElementById('month-prev').addEventListener('click', () => {
            document.getElementById('calendar-body').classList.add('fade-out');
            setTimeout(() => {
                date.setMonth(date.getMonth() - 1); //asigna el mes
                renderCalendar();
                document.getElementById('calendar-body').classList.remove('fade-out');
            }, 500);
        });

        document.getElementById('month-next').addEventListener('click', () => {
            document.getElementById('calendar-body').classList.add('fade-out');
            setTimeout(() => {
                date.setMonth(date.getMonth() + 1);//asigna el mes
                renderCalendar();
                document.getElementById('calendar-body').classList.remove('fade-out');
            }, 500);
        });

        renderCalendar();

        function calcularDiaProximoMes(año, mes) {
            // Día inicial
            const diaInicial = 29;
            // Sumar 8 días
            const diasASumar = 8;

            // Calcular el día final
            const diaFinal = diaInicial + diasASumar; //37


            // console.log('dF: ' + diaFinal)

            // Obtener el número de días en el mes actual
            const diasDelMesActual = new Date(año, mes + 1, 0).getDate(); //30

            let diaDelProximoMes;

            if (diaFinal > diasDelMesActual) {
                // Si el día final excede el número de días del mes actual
                const diasRestantes = diaFinal - diasDelMesActual; // Días que pasan al próximo mes
                diaDelProximoMes = diasRestantes; // Este será el día en el próximo mes
            } else {
                // Si el día final está dentro del mes actual
                diaDelProximoMes = diaFinal;
            }

            // console.log(`El día ${diaInicial} del mes ${mes + 1} más ${diasASumar} días es el día ${diaDelProximoMes} del próximo mes.`);
        }

        // Ejemplo de uso
        calcularDiaProximoMes(2024, 8); // Para septiembre de 2024

    </script>
</body>

</html>